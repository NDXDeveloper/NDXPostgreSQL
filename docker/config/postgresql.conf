# ============================================================================
# NDXPostgreSQL - Configuration PostgreSQL personnalisée
# ============================================================================
# FICHIER EXEMPLE - Non utilisé par défaut.
# Le docker-compose.yml utilise l'image postgres:18 avec sa config par défaut.
# Ce fichier est fourni comme référence pour personnaliser PostgreSQL
# (mémoire, WAL, timeouts, locales, etc.).
# ============================================================================
#
# Ce fichier contient les paramètres de configuration optimisés
# pour l'environnement de développement et de tests.
#
# Auteur: Nicolas DEOUX <NDXDev@gmail.com>
# ============================================================================

# -----------------------------------------------------------------------------
# Connexions et authentification
# -----------------------------------------------------------------------------
listen_addresses = '*'
port = 5432
max_connections = 100

# Timeout pour l'authentification
authentication_timeout = 1min

# -----------------------------------------------------------------------------
# Mémoire
# -----------------------------------------------------------------------------
# Mémoire partagée pour le cache
shared_buffers = 256MB

# Mémoire de travail par opération (tri, hash)
work_mem = 16MB

# Mémoire pour les opérations de maintenance (VACUUM, CREATE INDEX)
maintenance_work_mem = 64MB

# Cache effectif estimé (pour le planificateur de requêtes)
effective_cache_size = 512MB

# -----------------------------------------------------------------------------
# WAL (Write-Ahead Logging)
# -----------------------------------------------------------------------------
# Niveau de WAL (minimal pour les tests, replica pour la prod)
wal_level = minimal

# Synchronisation des WAL (off pour les tests, on pour la prod)
fsync = off
synchronous_commit = off

# Taille maximale du WAL
max_wal_size = 1GB
min_wal_size = 80MB

# -----------------------------------------------------------------------------
# Checkpoints
# -----------------------------------------------------------------------------
checkpoint_completion_target = 0.9
checkpoint_timeout = 10min

# -----------------------------------------------------------------------------
# Planificateur de requêtes
# -----------------------------------------------------------------------------
random_page_cost = 1.1
effective_io_concurrency = 200

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Destination des logs
log_destination = 'stderr'

# Journalisation des requêtes lentes
log_min_duration_statement = 2000
log_statement = 'none'
log_duration = off

# Format des logs
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_timezone = 'Europe/Paris'

# -----------------------------------------------------------------------------
# Statistiques
# -----------------------------------------------------------------------------
track_activities = on
track_counts = on
track_io_timing = on

# -----------------------------------------------------------------------------
# Autovacuum
# -----------------------------------------------------------------------------
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min

# -----------------------------------------------------------------------------
# Localisation
# -----------------------------------------------------------------------------
datestyle = 'iso, dmy'
timezone = 'Europe/Paris'
lc_messages = 'en_US.UTF-8'
lc_monetary = 'fr_FR.UTF-8'
lc_numeric = 'fr_FR.UTF-8'
lc_time = 'fr_FR.UTF-8'
default_text_search_config = 'pg_catalog.french'

# -----------------------------------------------------------------------------
# Timeout des verrous
# -----------------------------------------------------------------------------
lock_timeout = 120000
statement_timeout = 300000
idle_in_transaction_session_timeout = 600000

# -----------------------------------------------------------------------------
# Sécurité (pour les tests - adapter en production)
# -----------------------------------------------------------------------------
ssl = off
password_encryption = scram-sha-256
